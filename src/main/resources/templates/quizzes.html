<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons">
  <link href="css/style.css" rel="stylesheet">
  <!-- Header Fragment -->
  <header th:replace="~{fragments/header :: header}"></header>
  <style>
  </style>
</head>

<body id="Mbody">
  <h1 style="text-align: center; color: #000000; font-size: 3rem; margin-top: 30px;">Math Quiz!</h1>

  <!-- Timer -->
  <div id="quiz-timer">⏰ Time Remaining: 5:00</div>

  <!-- Quiz Container -->
  <div class="quiz-container">
    <!-- Quiz Question -->
    <div class="quiz-question">
      <h3 id="question"></h3>
      <div class="quiz-options">
        <ul id="options-list">
          <!-- Answers will be dynamically inserted here -->
        </ul>
      </div>
    </div>

    <!-- Quiz Navigation -->
    <div class="quiz-navigation">
      <button id="prev-btn" disabled>⬅️ Previous</button>
      <button id="next-btn">Next ➡️</button>
    </div>
  </div>

  <script th:inline="javascript">
    const quizzes = [[${quizzes}]]; // Correct syntax for Thymeleaf. DO NOT CHANGE!
    let currentQuestionIndex = 0;

    // Function to update the quiz question and options
    function updateQuiz() {
      const quiz = quizzes[currentQuestionIndex];
      document.getElementById('question').textContent = quiz.question;

      const optionsList = document.getElementById('options-list');
      optionsList.innerHTML = ''; // Clear previous options

      // Split answers by comma and create radio buttons for each
      quiz.answers.split(',').forEach((answer, index) => {
        const li = document.createElement('li');
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'answer';
        input.value = answer;
        input.id = `answer${index}`;

        const label = document.createElement('label');
        label.htmlFor = `answer${index}`;
        label.textContent = answer;

        li.appendChild(input);
        li.appendChild(label);
        optionsList.appendChild(li);
      });

      // Enable/disable Previous button
      document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
    }

    // Event listeners for navigation
    document.addEventListener("DOMContentLoaded", () => {
      updateQuiz(); // Load the first question

      document.getElementById("next-btn").addEventListener("click", () => {
        if (currentQuestionIndex < quizzes.length - 1) {
          currentQuestionIndex++;
          updateQuiz();
        } else {
          submitQuiz(); // Only submit if it's the last question
        }
      });

      document.getElementById("prev-btn").addEventListener("click", () => {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          updateQuiz();
        }
      });
    });

    // Function to submit the quiz
    function submitQuiz() {
      const selectedAnswers = [];
      quizzes.forEach((quiz, index) => {
        const selectedAnswer = document.querySelector(`input[name="answer"]:checked`);
        if (selectedAnswer) {
          selectedAnswers.push(selectedAnswer.value);
        } else {
          selectedAnswers.push(null); // Push null if no answer is selected
        }
      });

      fetch('/submit-quiz', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          timeRemaining: timeRemaining,
          answers: selectedAnswers, // Send selected answers to the server
        }),
      })
        .then(response => response.json())
        .then(data => {
          window.location.href = '/result'; // Redirect to results page
        })
        .catch(error => {
          console.error('Error submitting quiz:', error);
        });
    }
  </script>

  <script src="js/timer.js"></script>
</body>
<!-- footer Fragment -->
<footer th:replace="~{fragments/footer :: footer}"></footer>

</html>